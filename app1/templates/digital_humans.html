<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>æ•°å­—äººç®¡ç†</title>
    <style>
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
        }
        input[type="text"],
        textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        textarea {
            height: 100px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        .digital-human-list {
            margin-top: 30px;
        }
        .digital-human-item {
            border: 1px solid #ddd;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 5px;
        }
        .digital-human-info {
            margin-bottom: 10px;
        }
        .digital-human-files {
            margin-top: 10px;
        }
        .file-item {
            margin-bottom: 5px;
        }
        .actions {
            margin-top: 10px;
        }
        .delete-btn {
            background-color: #f44336;
        }
        .delete-btn:hover {
            background-color: #da190b;
        }
        .navigation {
            margin-bottom: 20px;
        }
        .navigation a {
            margin-right: 10px;
        }
        .digital-human-documents {
            margin-top: 10px;
        }
        .document-upload-form {
            margin-bottom: 10px;
        }
        .document-list {
            margin-top: 10px;
        }
        .document-item {
            margin-bottom: 5px;
        }
        .document-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .document-actions {
            display: flex;
            gap: 5px;
        }
        .delete-doc-btn {
            background-color: #f44336;
        }
        .delete-doc-btn:hover {
            background-color: #da190b;
        }
        .digital-human-audio-files {
            margin-top: 10px;
        }
        .audio-list {
            margin-top: 10px;
        }
        .audio-item {
            margin-bottom: 5px;
        }
        .audio-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .audio-actions {
            display: flex;
            gap: 5px;
        }
        .delete-audio-btn {
            background-color: #f44336;
        }
        .delete-audio-btn:hover {
            background-color: #da190b;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>æ•°å­—äººç®¡ç† - {{ user.username }}</h1>
        
        <!-- å¯¼èˆªé“¾æ¥ -->
        <div class="navigation">
            <a href="{{ url_for('audio', user_id=user.id) }}">ğŸµ éŸ³é¢‘ç®¡ç†</a> |
            <a href="{{ url_for('edit_profile', id=user.id) }}">ğŸ‘¤ ç”¨æˆ·ä¿¡æ¯</a>
        </div>
        
        {% with messages = get_flashed_messages() %}
            {% if messages %}
                <ul>
                    {% for message in messages %}
                        <li>{{ message }}</li>
                    {% endfor %}
                </ul>
            {% endif %}
        {% endwith %}
        
        <!-- åˆ›å»ºæ–°æ•°å­—äººè¡¨å• -->
        <h2>åˆ›å»ºæ–°æ•°å­—äºº</h2>
        <form method="POST" action="{{ url_for('digital_humans', user_id=user.id) }}" enctype="multipart/form-data">
            <div class="form-group">
                <label for="name">å§“åï¼š</label>
                <input type="text" id="name" name="name" required>
            </div>
            
            <div class="form-group">
                <label for="phone">ç”µè¯å·ç ï¼š</label>
                <input type="text" id="phone" name="phone">
            </div>
            
            <div class="form-group">
                <label for="description">æè¿°ï¼š</label>
                <textarea id="description" name="description"></textarea>
            </div>
            
            <div class="form-group">
                <label for="reference_audio">å‚è€ƒéŸ³é¢‘ï¼š</label>
                <input type="file" id="reference_audio" name="reference_audio" accept="audio/*">
            </div>
            
            <div class="form-group">
                <label for="train_audio">è®­ç»ƒéŸ³é¢‘ï¼š</label>
                <input type="file" id="train_audio" name="train_audio" accept="audio/*">
            </div>
            
            <div class="form-group">
                <label for="image">å›¾ç‰‡ï¼š</label>
                <input type="file" id="image" name="image" accept="image/*">
            </div>
            
            <div class="form-group">
                <label for="video">è§†é¢‘ï¼š</label>
                <input type="file" id="video" name="video" accept="video/*">
            </div>
            
            <div class="form-group">
                <label for="patient_info">æ‚£è€…ä¿¡æ¯ï¼š</label>
                <input type="file" id="patient_info" name="patient_info">
            </div>
            
            <button type="submit">åˆ›å»ºæ•°å­—äºº</button>
        </form>
        
        <!-- æ•°å­—äººåˆ—è¡¨ -->
        <div class="digital-human-list">
            <h2>æˆ‘çš„æ•°å­—äºº</h2>
            {% for dh in digital_humans %}
                <div class="digital-human-item" id="dh-{{ dh.id }}">
                    <div class="digital-human-info">
                        <h3>{{ dh.name }}</h3>
                        <p>ç”µè¯ï¼š{{ dh.phone }}</p>
                        <p>æè¿°ï¼š{{ dh.description }}</p>
                        <p>åˆ›å»ºæ—¶é—´ï¼š{{ dh.created_at }}</p>
                    </div>
                    
                    <div class="digital-human-files">
                        {% if dh.reference_audio_path %}
                            <div class="file-item">
                                <strong>å‚è€ƒéŸ³é¢‘ï¼š</strong>
                                <audio controls>
                                    <source src="{{ url_for('static', filename='uploads/' + dh.reference_audio_path) }}">
                                    æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘å…ƒç´ ã€‚
                                </audio>
                            </div>
                        {% endif %}
                        
                        {% if dh.train_audio_path %}
                            <div class="file-item">
                                <strong>è®­ç»ƒéŸ³é¢‘ï¼š</strong>
                                <audio controls>
                                    <source src="{{ url_for('static', filename='uploads/' + dh.train_audio_path) }}">
                                    æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘å…ƒç´ ã€‚
                                </audio>
                            </div>
                        {% endif %}
                        
                        {% if dh.image_path %}
                            <div class="file-item">
                                <strong>å›¾ç‰‡ï¼š</strong>
                                <img src="{{ url_for('static', filename='uploads/' + dh.image_path) }}" 
                                     alt="{{ dh.name }}çš„å›¾ç‰‡" style="max-width: 200px;">
                            </div>
                        {% endif %}
                        
                        {% if dh.video_path %}
                            <div class="file-item">
                                <strong>è§†é¢‘ï¼š</strong>
                                <video controls width="320" height="240">
                                    <source src="{{ url_for('static', filename='uploads/' + dh.video_path) }}">
                                    æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè§†é¢‘å…ƒç´ ã€‚
                                </video>
                            </div>
                        {% endif %}
                        
                        {% if dh.patient_info_path %}
                            <div class="file-item">
                                <strong>æ‚£è€…ä¿¡æ¯ï¼š</strong>
                                <a href="{{ url_for('static', filename='uploads/' + dh.patient_info_path) }}" target="_blank">æŸ¥çœ‹æ‚£è€…ä¿¡æ¯</a>
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- æ–‡æ¡£ç®¡ç†éƒ¨åˆ† -->
                    <div class="digital-human-documents">
                        <h4>å…³è”æ–‡æ¡£</h4>
                        
                        <!-- ä¸Šä¼ æ–‡æ¡£è¡¨å• -->
                        <form action="{{ url_for('documents', user_id=user.id, dh_id=dh.id) }}" method="post" enctype="multipart/form-data" class="document-upload-form">
                            <div class="form-group">
                                <label for="title_{{ dh.id }}">æ–‡æ¡£æ ‡é¢˜ï¼š</label>
                                <input type="text" id="title_{{ dh.id }}" name="title" required>
                            </div>
                            <div class="form-group">
                                <label for="description_{{ dh.id }}">æ–‡æ¡£æè¿°ï¼š</label>
                                <textarea id="description_{{ dh.id }}" name="description" rows="2"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="document_{{ dh.id }}">é€‰æ‹©æ–‡ä»¶ï¼š</label>
                                <input type="file" id="document_{{ dh.id }}" name="document" required>
                            </div>
                            <button type="submit">ä¸Šä¼ æ–‡æ¡£</button>
                        </form>
                        
                        <!-- èŠå¤©è®°å½•å¯¼å…¥è¡¨å• -->
                        <div class="upload-section">
                            <h4>å¯¼å…¥èŠå¤©è®°å½•</h4>
                            <form action="{{ url_for('import_chat', dh_id=dh.id, user_id=user.id) }}" method="post" enctype="multipart/form-data">
                                <div class="form-group">
                                    <label for="chat_file">é€‰æ‹©èŠå¤©è®°å½•æ–‡ä»¶:</label>
                                    <input type="file" name="chat_file" accept=".txt" required>
                                    <small class="form-text text-muted">è¯·é€‰æ‹©ä»èŠå¤©åº”ç”¨å¯¼å‡ºçš„.txtæ–‡ä»¶</small>
                                </div>
                                <button type="submit" class="btn btn-info">å¯¼å…¥èŠå¤©è®°å½•</button>
                            </form>
                        </div>
                        
                        <!-- æ˜¾ç¤ºå…³è”æ–‡æ¡£ -->
                        {% if dh.documents %}
                            <div class="document-list">
                                <ul>
                                    {% for doc in dh.documents %}
                                        <li class="document-item">
                                            <div class="document-info">
                                                <strong>{{ doc.title }}</strong>
                                                {% if doc.description %} - {{ doc.description }}{% endif %}
                                                <div class="document-actions">
                                                    <a href="{{ url_for('static', filename='uploads/' + doc.filepath) }}" target="_blank">æŸ¥çœ‹</a>
                                                    <form action="{{ url_for('delete_document', id=doc.id, user_id=user.id, return_to='digital_humans') }}" method="post" style="display: inline;">
                                                        <button type="submit" class="delete-doc-btn">åˆ é™¤</button>
                                                    </form>
                                                </div>
                                            </div>
                                        </li>
                                    {% endfor %}
                                </ul>
                            </div>
                        {% else %}
                            <p>æš‚æ— å…³è”æ–‡æ¡£</p>
                        {% endif %}
                    </div>
                    
                    <!-- éŸ³é¢‘ç®¡ç†éƒ¨åˆ† -->
                    <div class="digital-human-audio-files">
                        <h4>å…³è”éŸ³é¢‘</h4>
                        
                        <!-- éŸ³é¢‘æ–‡ä»¶é“¾æ¥ -->
                        <div>
                            <a href="{{ url_for('audio', user_id=user.id, dh_id=dh.id) }}" class="btn">ç®¡ç†éŸ³é¢‘æ–‡ä»¶</a>
                        </div>
                        
                        <!-- æ˜¾ç¤ºå…³è”éŸ³é¢‘ -->
                        {% if dh.audio_files %}
                            <div class="audio-list">
                                <ul>
                                    {% for audio in dh.audio_files %}
                                        <li class="audio-item">
                                            <div class="audio-info">
                                                <strong>{{ audio.filename }}</strong>
                                                <audio controls>
                                                    <source src="{{ url_for('static', filename=audio.filepath) }}">
                                                    æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘å…ƒç´ ã€‚
                                                </audio>
                                                <div class="audio-actions">
                                                    <form action="{{ url_for('delete', id=audio.id, user_id=user.id, return_to='digital_humans') }}" method="post" style="display: inline;">
                                                        <button type="submit" class="delete-audio-btn">åˆ é™¤</button>
                                                    </form>
                                                </div>
                                            </div>
                                        </li>
                                    {% endfor %}
                                </ul>
                            </div>
                        {% else %}
                            <p>æš‚æ— å…³è”éŸ³é¢‘</p>
                        {% endif %}
                    </div>
                    
                    <div class="actions">
                        <form action="{{ url_for('delete_digital_human', id=dh.id) }}" method="post" style="display: inline;">
                            <button type="submit" class="delete-btn">åˆ é™¤</button>
                        </form>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
</body>
</html> 