<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>上传音频</title>
</head>
<body>
    <h1>音频管理</h1>

    <!-- 导航链接 -->
    <div class="navigation">
        <a href="{{ url_for('digital_humans', user_id=user_id) }}">🤖 数字人管理</a> |
        <a href="{{ url_for('documents', user_id=user_id) }}">📄 文档管理</a> |
        <a href="{{ url_for('edit_profile', id=user_id) }}">👤 用户信息</a>
    </div>

    <!-- 显示当前数字人信息 -->
    {% if current_dh %}
    <div class="current-digital-human">
        <h3>当前数字人：{{ current_dh.name }}</h3>
        <p>电话：{{ current_dh.phone }}</p>
        <p>描述：{{ current_dh.description }}</p>
    </div>
    {% endif %}

    <form action="{{ url_for('audio', user_id=user_id) }}" method="post" enctype="multipart/form-data">
        <div class="form-group">
            <label for="audio">选择音频文件：</label>
            <input type="file" name="audio" id="audio" accept="audio/*">
        </div>
        
        <div class="form-group">
            <label for="digital_human_id">关联数字人：</label>
            <select id="digital_human_id" name="digital_human_id">
                <option value="">不关联</option>
                {% for dh in digital_humans %}
                    <option value="{{ dh.id }}" {% if current_dh and dh.id == current_dh.id %}selected{% endif %}>
                        {{ dh.name }}
                    </option>
                {% endfor %}
            </select>
        </div>
        
        <button type="submit">上传</button>
    </form>

    <h2>已上传的音频文件</h2>
    <ul>
        {% for file in files %}
            <li>
                <audio controls>
                    <source src="{{ url_for('static', filename=file.filepath) }}">
                    您的浏览器不支持音频元素。
                </audio>
                
                <p>{{ file.filename }}</p>
                <p>上传时间: {{ file.upload_time }}</p>
                {% if file.digital_human %}
                    <p>关联数字人: {{ file.digital_human.name }}</p>
                {% endif %}

                <!-- 删除按钮 -->
                <form action="{{ url_for('delete', id=file.id, user_id=user_id) }}" method="post">
                    <button type="submit">删除</button>
                </form>
            </li>
        {% endfor %}
    </ul>

    <!-- 显示 flash 消息 -->
    {% with messages = get_flashed_messages() %}
        {% if messages %}
            <ul>
                {% for message in messages %}
                    <li>{{ message }}</li>
                {% endfor %}
            </ul>
        {% endif %}
    {% endwith %}
</body>
</html>
